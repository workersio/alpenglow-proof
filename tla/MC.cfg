\* TLC MODEL CONFIGURATION — quick sanity model for auditors
\* To run the audit-recommended skipped-slot scenario, change Spec to SkippedSlotSpec.
SPECIFICATION Spec

\* Model values
CONSTANTS
    v1 = v1
    v2 = v2
    v3 = v3
    v4 = v4
    b0 = b0
    b1 = b1
    b2 = b2
    b3 = b3
    b4 = b4
    b5 = b5
    nullBlock = nullBlock

\* Assign values to constants (mirrors §1.5, reduced so TLC finishes fast)
CONSTANTS
    NumValidators = 4
    ByzantineCount = 0  \* TEMPORARILY DISABLED to verify honest protocol path
    GST = 3
    MaxSlot = 2      \* Increased for more robust checking
    MaxBlocks = 3    \* Increased for more robust checking
    \* Timing params sized for fast TLC exploration only — not real-world latencies
    \* See Whitepaper Def. 17 for semantics and units relative to `clock`.
    DeltaTimeout = 1
    DeltaBlock = 1
    \* Latency parameters for bounded-time finalization (δ_θ bounds)
    Delta80 = 6
    Delta60 = 4
    WindowSize = 2
    RotorFanout = 2  \* Increased for more robust checking
    RotorMinRelayStake = 40
    RotorGamma = 1
    RotorMaxFailedRelayStake = 10
    GammaTotalShreds = 5
    GammaDataShreds = 1
    KappaExpRatio = 2
    Validators = {v1, v2, v3, v4}
    Slots = {1, 2}
    BlockHashes = {b0, b1, b2, b3, b4, b5}
    NoBlock = nullBlock
    GenesisHash = b0
    WindowLeader <- MC_WindowLeader
    
    \* Use the function defined in MC.tla
    StakeMap <- MC_StakeMap

\* Invariants - ALL critical safety properties - used as a list for better debugging
INVARIANTS TypeInvariant
INVARIANTS SafetyInvariant
INVARIANTS NoConflictingFinalization
INVARIANTS SafeToSkipPrecludesFastNow
INVARIANTS ChainConsistency
INVARIANTS VoteUniqueness
INVARIANTS UniqueNotarization
INVARIANTS GlobalNotarizationUniqueness
INVARIANTS FinalizedImpliesNotarized
INVARIANTS CertificateNonEquivocation
INVARIANTS Lemma21_FastFinalizationProperty
INVARIANTS NoMixFinalizationAndFallback
INVARIANTS Lemma23_FortyPercentPreventsConflictingNotar
INVARIANTS Lemma26_SlowFinalizationProperty
INVARIANTS PoolSkipVsBlockExclusion
INVARIANTS HonestNonEquivocation
INVARIANTS TransitCertificatesValid
INVARIANTS TransitVotesValid
INVARIANTS LocalVotesWellFormed
INVARIANTS PoolFastPathImplication
INVARIANTS PoolFinalizationImpliesNotarizationPresent
INVARIANTS CertificateBlockProvenance
INVARIANTS ByzantineStakeOK
INVARIANTS Assumption2OK
INVARIANTS PoolMultiplicityOK
INVARIANTS PoolCertificateUniqueness
INVARIANTS PoolCertificatesValid
INVARIANTS PoolCertificatesWellFormedOK
INVARIANTS PoolAlignmentOK
INVARIANTS BucketSlotConsistencyOK
INVARIANTS PoolSkipFallbackAfterInitialNotarOK
INVARIANTS RotorSelectSoundness
INVARIANTS TimeoutsInFuture
INVARIANTS LocalClockMonotonic
INVARIANTS ParentSlotConsistency
INVARIANTS FinalizedAncestorClosure
INVARIANTS BlockNotarizedImpliesCert
INVARIANTS ParentReadyImpliesCert
INVARIANTS ParentReadyUsesPreviousBlock
INVARIANTS FinalVoteImpliesBlockNotarized
INVARIANTS VotedConsistency
INVARIANTS ParentReadyConsistencyAll
INVARIANTS PendingBlocksSingletonAll
INVARIANTS PendingBlocksSlotAlignedAll
INVARIANTS VotedNotarTagConsistency
INVARIANTS BadWindowWitness
INVARIANTS ItsOverWitness
INVARIANTS TotalNotarStakeSanity

\* State constraint
CONSTRAINT StateConstraint

\* Liveness properties (bounded TLC check; relies on partial synchrony and
\* weak fairness assumptions encoded in Spec and parameters GST/Delta).
PROPERTIES
    BasicLiveness
    FastPathOneRound
    Progress
    WindowFinalizationAll
    Liveness60Responsive
    CrashToleranceLiveness20
    RepairEventuallySucceeds
